<!-- AI Feaure disabled, If Integrate AI feaures again, remove note on footer -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note: API key deleted on 2025-10-18. AI Feature disabled.</title>
	<!-- Your Work, Your Well-Being, In Sync. -->
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel Standalone for JSX compilation in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Essential for React to render correctly and handle full-screen layout */
        #root {
            height: 100%;
            width: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-100 font-sans p-4 md:p-8 flex flex-col min-h-screen">
    <div id="root" class="flex-grow flex items-center justify-center"></div>

    <script type="text/babel">
        // Wait for the window to load before running the React code to ensure ReactDOM is available
        window.onload = function() {
            const { useState, useEffect, useRef } = React;

            // Mock data for AI nudges and breaks
            const focusNudges = [
                "Focus is a muscle. You're building it now.",
                "Remember your intention for this session.",
                "Small steps lead to big progress.",
                "Breathe deeply and recenter. You've got this.",
                "Just a little longer. Stay in the zone.",
                "You are in control of your focus."
            ];

            const breakActivities = ['breathing', 'stretching', 'reflecting'];
            const breathingPrompts = ["Box Breathing: Inhale 4s, Hold 4s, Exhale 4s, Hold 4s."];
            const stretchingPrompts = ["Neck Stretch: Gently tilt your head to one side, bringing your ear toward your shoulder."];
            const reflectionPrompts = ["What is one small victory you had today?"];

            // New, more professional quotes for inspiration
            const professionalQuotes = [
                "The greatest danger for most of us is not that our aim is too high and we miss it, but that it is too low and we reach it. - Michelangelo",
                "The best way to predict the future is to create it. - Peter Drucker",
                "What you do every day matters more than what you do once in a while. - Gretchen Rubin",
                "The price of success is hard work, dedication to the job at hand, and the determination that whether we win or lose, we have applied the best of ourselves to the task at hand. - Vince Lombardi",
                "Eighty percent of success is showing up. - Woody Allen",
                "Focus is a matter of deciding what things you're not going to do. - John Carmack",
                "Your work is going to fill a large part of your life, and the only way to be truly satisfied is to do what you believe is great work. - Steve Jobs",
                "Success is the sum of small efforts, repeated day-in and day-out. - Robert Collier",
                "The difference between a successful person and others is not a lack of strength, not a lack of knowledge, but rather a lack of will. - Vince Lombardi"
            ];
            
            // Function to format time from seconds to MM:SS
            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            };
            
            // MindfulBreakModal component
            const MindfulBreakModal = ({ onEndBreak, currentBreakActivity, breakTimer, setBreakTimer }) => {
                const breakTimerRef = useRef(null);
                
                useEffect(() => {
                    if (breakTimer > 0) {
                        breakTimerRef.current = setInterval(() => {
                            setBreakTimer(prev => prev - 1);
                        }, 1000);
                    } else if (breakTimer === 0 && currentBreakActivity !== 'reflection') {
                        clearInterval(breakTimerRef.current);
                        onEndBreak();
                    }
                    
                    return () => clearInterval(breakTimerRef.current);
                }, [breakTimer]);

                const getPrompt = () => {
                    switch(currentBreakActivity) {
                        case 'breathing':
                            return breathingPrompts[0];
                        case 'stretching':
                            return stretchingPrompts[0];
                        case 'reflecting':
                            return reflectionPrompts[0];
                        default:
                            return "";
                    }
                }
                
                const getTitle = () => {
                    switch(currentBreakActivity) {
                        case 'breathing':
                            return "Breathing Exercise";
                        case 'stretching':
                            return "Simple Stretching";
                        case 'reflecting':
                            return "Mindful Reflection";
                        default:
                            return "Mindful Break";
                    }
                }

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        <div className="bg-white rounded-[2rem] shadow-2xl p-8 max-w-lg w-full text-center">
                            <h3 className="text-3xl font-bold text-gray-800 mb-4">{getTitle()}</h3>
                            <p className="text-xl italic text-gray-600 mb-6">"{getPrompt()}"</p>
                            {currentBreakActivity !== 'reflection' && (
                                <div className="text-6xl font-mono font-light text-blue-800 mb-6 tracking-tighter">
                                    {formatTime(breakTimer)}
                                </div>
                            )}
                            <button onClick={onEndBreak} className="py-3 px-8 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-700 transition-colors shadow-md">
                                {breakTimer > 0 ? "Skip Break" : "Return to Work"}
                            </button>
                        </div>
                    </div>
                );
            }

            // MetricsDashboardModal component to display the success metrics
            const MetricsDashboardModal = ({ onClose, selectedTime, utilizedTime, dailyHabitsCount, habitsCompleted, tasksCompleted, tasksAssigned, productivityScore }) => {
                const metrics = [
                    { title: "Focus Time Goal", value: `${selectedTime} min`, color: "bg-blue-50", borderColor: "border-blue-200", textColor: "text-blue-700" },
                    { title: "Focus Time Utilized", value: `${utilizedTime} min`, color: "bg-blue-50", borderColor: "border-blue-200", textColor: "text-blue-700" },
                    { title: "Daily Habits Assigned", value: `${dailyHabitsCount}`, color: "bg-purple-50", borderColor: "border-purple-200", textColor: "text-purple-700" },
                    { title: "Habits Completed", value: `${habitsCompleted}`, color: "bg-purple-50", borderColor: "border-purple-200", textColor: "text-purple-700" },
                    { title: "Tasks Assigned", value: `${tasksAssigned}`, color: "bg-teal-50", borderColor: "border-teal-200", textColor: "text-teal-700" },
                    { title: "Tasks Completed", value: `${tasksCompleted}`, color: "bg-teal-50", borderColor: "border-teal-200", textColor: "text-teal-700" },
                ];
                
                return (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                        {/* Added max-h-screen and overflow-y-auto for scrollability on small screens */}
                        <div className="bg-white rounded-[2rem] shadow-2xl p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
                            <h3 className="text-3xl font-bold text-gray-800 mb-6 text-center">Your Productivity Metrics</h3>
                            
                            {/* Productivity Score Section with new styling */}
                            <div className="bg-indigo-100 p-6 rounded-xl border border-indigo-200 text-center mb-6">
                                <div className="text-5xl font-bold text-indigo-700 mb-2">{productivityScore}%</div>
                                <h4 className="text-xl font-bold text-gray-800">Overall Productivity Score</h4>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {metrics.map((metric, index) => (
                                    <div key={index} className={`${metric.color} p-6 rounded-2xl border-2 ${metric.borderColor} text-center`}>
                                        <div className={`text-5xl font-extrabold ${metric.textColor} mb-2`}>{metric.value}</div>
                                        <h4 className="text-xl font-bold text-gray-800 mb-1">{metric.title}</h4>
                                    </div>
                                ))}
                            </div>
                            <div className="flex justify-center mt-8">
                                <button onClick={onClose} className="py-3 px-8 bg-gray-600 text-white rounded-full font-bold hover:bg-gray-700 transition-colors">Close Dashboard</button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // SuccessModal component to display completion message
            const SuccessModal = ({ onClose }) => (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className="bg-white rounded-[2rem] shadow-2xl p-8 max-w-sm w-full text-center">
                        <h3 className="text-3xl font-bold text-green-700 mb-4">Session Complete!</h3>
                        <p className="text-xl text-gray-600 mb-6">You successfully completed a full focus session. Great job!</p>
                        <button onClick={onClose} className="py-3 px-8 bg-green-600 text-white rounded-full font-bold hover:bg-green-700 transition-colors shadow-md">Awesome!</button>
                    </div>
                </div>
            );
            
            // The main App component, containing all application logic and UI
            const App = () => {
                // State management for various app functionalities
                const [tasks, setTasks] = useState([]);
                const [inputValue, setInputValue] = useState('');
                const [timer, setTimer] = useState(1500); // 25 minutes in seconds
                const [isFocused, setIsFocused] = useState(false);
                const [nudge, setNudge] = useState('');
                const [showWarning, setShowWarning] = useState(false);
                const [currentDateTime, setCurrentDateTime] = useState(new Date());
                const [sessionDurationMinutes, setSessionDurationMinutes] = useState(25);
                const [dailyQuote, setDailyQuote] = useState(professionalQuotes[Math.floor(Math.random() * professionalQuotes.length)]);
                const [habits, setHabits] = useState([]);
                const [showHabitModal, setShowHabitModal] = useState(false);
                const [newHabitName, setNewHabitName] = useState('');
                const [recurringInterval, setRecurringInterval] = useState(10);
                const [activeHabitNudge, setActiveHabitNudge] = useState(null);
                const [showAIModal, setShowAIModal] = useState(false);
                const [aiSteps, setAiSteps] = useState([]);
                const [aiLoading, setAiLoading] = useState(false);
                const [showSuggestionsModal, setShowSuggestionsModal] = useState(false);
                const [suggestions, setSuggestions] = useState([]);
                const [isSuggestionsLoading, setIsSuggestionsLoading] = useState(false);
                const [suggestionsTitle, setSuggestionsTitle] = useState('');
                const [sessionHistory, setSessionHistory] = useState([]);
                const [initialTimer, setInitialTimer] = useState(0);
                const [showBreakActivityModal, setShowBreakActivityModal] = useState(false);
                const [currentBreakActivity, setCurrentBreakActivity] = useState(null);
                const [breakTimer, setBreakTimer] = useState(0);
                const [initiatedSessions, setInitiatedSessions] = useState(0);
                const [sessionsCompletedByTimer, setSessionsCompletedByTimer] = useState(0); // New state to track full completions
                const [completedBreaks, setCompletedBreaks] = useState(0);
                const [showMetricsModal, setShowMetricsModal] = useState(false);
                const [showSuccessModal, setShowSuccessModal] = useState(false); // New state for success message
                
                // New state variables for the updated metrics dashboard
                const [selectedFocusTime, setSelectedFocusTime] = useState(0);
                const [utilizedFocusTime, setUtilizedFocusTime] = useState(0);
                const [habitsCompleted, setHabitsCompleted] = useState(0);
                const [tasksCompleted, setTasksCompleted] = useState(0);
                const [tasksAssigned, setTasksAssigned] = useState(0);
                const [dailyHabitsCount, setDailyHabitsCount] = useState(0); // New state for daily habit count
                const [productivityScore, setProductivityScore] = useState(0);

                // Chatbot state
                const [chatHistory, setChatHistory] = useState([]);
                const [chatInput, setChatInput] = useState('');
                const [isChatLoading, setIsChatLoading] = useState(false);

                // Refs for managing intervals
                const timerRef = useRef(null);
                const recurringHabitRef = useRef(null);
                const isFirstSessionCompleted = useRef(false);
                
                // IMPORTANT FIX: Reset metrics on app load to prevent data from previous runs
                useEffect(() => {
                    console.log("App loaded. Resetting metrics to 0 for a clean start.");
                    setInitiatedSessions(0);
                    setSessionsCompletedByTimer(0);
                    setCompletedBreaks(0);
                }, []);
                
                // Effect to calculate productivity score whenever metrics change
                useEffect(() => {
                    const calculateScore = () => {
                        let score = 0;
                        let timeScore = 0;
                        let habitScore = 0;
                        let taskScore = 0;

                        // Calculate Time Score (max 40 points)
                        if (selectedFocusTime > 0) {
                            timeScore = (utilizedFocusTime / selectedFocusTime) * 40;
                        }
                        
                        // Calculate Habit Score (max 30 points)
                        if (dailyHabitsCount > 0) {
                            habitScore = (habitsCompleted / dailyHabitsCount) * 30;
                        }

                        // Calculate Task Score (max 30 points)
                        if (tasksAssigned > 0) {
                            taskScore = (tasksCompleted / tasksAssigned) * 30;
                        }

                        score = timeScore + habitScore + taskScore;

                        // Ensure the score does not exceed 100
                        const finalScore = Math.min(Math.round(score), 100);
                        setProductivityScore(finalScore);
                        console.log(`Score Calculation: Time Score: ${timeScore.toFixed(2)}, Habit Score: ${habitScore.toFixed(2)}, Task Score: ${taskScore.toFixed(2)}, Final Score: ${finalScore}`);
                    };
                    calculateScore();
                }, [selectedFocusTime, utilizedFocusTime, habitsCompleted, dailyHabitsCount, tasksCompleted, tasksAssigned]);


                // Function to update the daily quote with a new random one
                const updateDailyQuote = () => {
                    const newQuoteIndex = Math.floor(Math.random() * professionalQuotes.length);
                    setDailyQuote(professionalQuotes[newQuoteIndex]);
                };

                // Function to save a completed session to history
                const saveSessionHistory = (actualDuration) => {
                    const session = {
                        id: Date.now(),
                        date: new Date(),
                        duration: actualDuration,
                        tasks: tasks.map(t => t.text)
                    };
                    setSessionHistory(prevHistory => [...prevHistory, session]);
                };

                // Function to start a mindful break
                const startMindfulBreak = () => {
                    updateDailyQuote();
                    const randomActivity = breakActivities[Math.floor(Math.random() * breakActivities.length)];
                    setCurrentBreakActivity(randomActivity);
                    
                    if (randomActivity === 'breathing') {
                        setBreakTimer(120);
                    } else if (randomActivity === 'stretching') {
                        setBreakTimer(120);
                    } else { // reflection
                        setBreakTimer(0);
                    }
                    setShowBreakActivityModal(true);
                };
                
                // FIX: Consolidated session-ending logic into a single function
                const stopSession = (completedByTimer = false) => {
                    clearInterval(timerRef.current);
                    setIsFocused(false);
                    setShowWarning(false);
                    setNudge("Session ended. You can start a new one when you're ready.");

                    const elapsedTime = initialTimer - timer;
                    
                    let actualDuration;
                    if (completedByTimer) {
                        actualDuration = sessionDurationMinutes;
                        setSessionsCompletedByTimer(prev => prev + 1);
                        setShowSuccessModal(true);
                        startMindfulBreak();
                    } else {
                        actualDuration = Math.floor(elapsedTime / 60);
                    }
                    
                    saveSessionHistory(actualDuration);
                    setUtilizedFocusTime(prev => prev + actualDuration);
                    setTimer(sessionDurationMinutes * 60);
                };

                // Main focus timer effect
                useEffect(() => {
                    if (isFocused && timer > 0) {
                        timerRef.current = setInterval(() => {
                            setTimer((prevTimer) => prevTimer - 1);
                        }, 1000);
                    } else if (isFocused && timer === 0) {
                        stopSession(true);
                    }

                    return () => clearInterval(timerRef.current);
                }, [isFocused, timer, sessionDurationMinutes, initialTimer]); // Added initialTimer to dependency array
                
                // Clock effect
                useEffect(() => {
                    const clockInterval = setInterval(() => setCurrentDateTime(new Date()), 1000);
                    return () => clearInterval(clockInterval);
                }, []);
                
                // Combined habit notification effect for recurring habits
                useEffect(() => {
                    const habitInterval = setInterval(() => {
                        setHabits(currentHabits => currentHabits.map(habit => {
                            const now = new Date();
                            // Check for recurring habits
                            if (now.getTime() - (habit.lastNotified || 0) >= habit.recurringInterval * 60000) {
                                setActiveHabitNudge(habit);
                                // Update lastNotified time to prevent immediate re-notification
                                return { ...habit, lastNotified: now.getTime() };
                            }
                            return habit;
                        }));
                    }, 60000); // Check every minute
                    
                    return () => clearInterval(habitInterval);
                }, []);
                
                // UI helper functions
                const startFocusTimer = () => {
                    setTimer(sessionDurationMinutes * 60);
                    setSelectedFocusTime(prev => prev + sessionDurationMinutes); // Update selected focus time
                    setInitialTimer(sessionDurationMinutes * 60); // Store the initial timer value
                    setIsFocused(true);
                    setNudge("Session started. Let's get into the flow.");
                    setInitiatedSessions(prev => prev + 1);
                };

                const handleEndSessionWarning = () => setShowWarning(true);
                const endBreak = () => {
                    setShowBreakActivityModal(false);
                    setCompletedBreaks(prev => prev + 1);
                };
                const openMetrics = () => setShowMetricsModal(true);
                const closeMetrics = () => setShowMetricsModal(false);

                const clearHistory = () => {
                    setSessionHistory([]);
                    setInitiatedSessions(0);
                    setCompletedBreaks(0);
                    setSessionsCompletedByTimer(0);
                    setSelectedFocusTime(0);
                    setUtilizedFocusTime(0);
                    setHabits([]);
                    setTasks([]);
                    setHabitsCompleted(0);
                    setDailyHabitsCount(0);
                    setTasksCompleted(0);
                    setTasksAssigned(0);
                }
                const addTask = (e) => {
                    e.preventDefault();
                    if (inputValue.trim()) {
                        setTasks([...tasks, { id: Date.now(), text: inputValue, completed: false }]);
                        setTasksAssigned(prev => prev + 1); // Increment tasks assigned
                        setInputValue('');
                    }
                };
                const deleteTask = (taskId) => {
                    const deletedTask = tasks.find(task => task.id === taskId);
                    setTasks(tasks.filter(task => task.id !== taskId));
                    setTasksAssigned(prev => prev - 1); // Decrement tasks assigned
                    if (deletedTask && deletedTask.completed) {
                        setTasksCompleted(prev => prev - 1); // Decrement completed tasks if the deleted task was completed
                    }
                };
                const toggleTask = (id) => {
                    setTasks(tasks.map((task) =>
                        task.id === id ? { ...task, completed: !task.completed } : task
                    ));
                    const newTasksCompleted = tasks.filter(task => task.completed).length + (tasks.find(task => task.id === id).completed ? -1 : 1);
                    setTasksCompleted(newTasksCompleted);
                };
                const addHabit = (e) => {
                    e.preventDefault();
                    if (newHabitName.trim()) {
                        const newHabit = { 
                            id: Date.now(), 
                            name: newHabitName, 
                            recurringInterval: parseInt(recurringInterval), 
                            lastNotified: Date.now(), // Use timestamp for recurring
                            completed: false, 
                        };
                        setHabits([...habits, newHabit]);
                        setDailyHabitsCount(prev => prev + 1); // Increment daily habits count
                        setNewHabitName('');
                        setRecurringInterval(10);
                        setShowHabitModal(false);
                    }
                };
                const openHabitModal = () => setShowHabitModal(true);
                const closeHabitModal = () => {
                    setShowHabitModal(false);
                    setNewHabitName('');
                    setRecurringInterval(10);
                };
                const markHabitAsDone = (habitId) => {
                    setActiveHabitNudge(null);
                    setHabits(currentHabits => {
                        const updatedHabits = currentHabits.map(h => {
                            if (h.id === habitId) {
                                // Mark as completed and update the last notified time/date
                                return { ...h, completed: true, lastNotified: Date.now() };
                            }
                            return h;
                        });
                        // Recalculate completed habits count
                        const newHabitsCompleted = updatedHabits.filter(h => h.completed).length;
                        setHabitsCompleted(newHabitsCompleted);
                        return updatedHabits;
                    });
                };
                const toggleHabit = (id) => {
                    setHabits(habits.map((habit) =>
                        habit.id === id ? { ...habit, completed: !habit.completed } : habit
                    ));
                    const newHabitsCompleted = habits.filter(habit => habit.completed).length + (habits.find(habit => habit.id === id).completed ? -1 : 1);
                    setHabitsCompleted(newHabitsCompleted);
                };

                // Function to delete a habit
                const deleteHabit = (habitId) => {
                    const deletedHabit = habits.find(h => h.id === habitId);
                    setHabits(habits.filter(habit => habit.id !== habitId));
                    setDailyHabitsCount(prev => prev - 1); // Decrement daily habits count
                    if (deletedHabit && deletedHabit.completed) {
                        setHabitsCompleted(prev => prev - 1); // Decrement completed habits if the deleted habit was completed
                    }
                };

                const formatDateTime = (date) => {
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', second: 'numeric' };
                    const formattedDate = date.toLocaleDateString('en-US', options);
                    const gmtOffset = -date.getTimezoneOffset();
                    const sign = gmtOffset >= 0 ? '+' : '-';
                    const gmtHours = Math.floor(Math.abs(gmtOffset) / 60);
                    const gmtMinutes = Math.abs(gmtOffset) % 60;
                    const gmtString = `GMT${sign}${String(gmtHours).padStart(2, '0')}:${String(gmtMinutes).padStart(2, '0')}`;
                    return `${formattedDate} (${gmtString})`;
                };
                const totalFocusedMinutes = sessionHistory.reduce((total, session) => total + session.duration, 0);


                const getAISuggestions = async () => {
                    setIsSuggestionsLoading(true);
                    setShowSuggestionsModal(true);
                    setSuggestions([]);
                    
                    const apiKey = "AIzaSyDZQ_6Gll1-fDTtBOPDg-Jg4oswPu-KR_E";
				    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    let systemPrompt = "You are a personalized productivity and wellness coach. Provide a short, simple, actionable list of suggestions.";
                    let userQuery = "";
                    let title = "";

                    if (isFocused) {
                        const remainingMinutes = Math.floor(timer / 60);
                        if (remainingMinutes < 5) {
                            title = "Time for a Break?";
                            userQuery = `The user has been focused for a long time. Their tasks are: ${tasks.map(t => t.text).join(', ')}. Provide a positive reinforcement message, congratulate them on their focus, and suggest a break with a specific, simple, relaxing activity.`;
                        } else {
                            title = "Focus Rituals & Nudges";
                            userQuery = `The user is in a focus session with ${remainingMinutes} minutes left. Their current tasks are: ${tasks.map(t => t.text).join(', ')}. Provide a short, motivational nudge and a couple of quick rituals to help them stay focused.`;
                        }
                    } else if (showBreakActivityModal) {
                        title = "Break Rituals";
                        userQuery = "The user is on a break. Provide a short, actionable ritual to help them relax and reset before their next session.";
                    } else {
                        title = "Personalized Focus Ritual";
                        userQuery = `The user is about to start a new focus session. Their current tasks are: ${tasks.map(t => t.text).join(', ')}. Create a short, 3-step ritual to prepare them for the session.`;
                    }
                    
                    setSuggestionsTitle(title);

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };
                    
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (generatedText) {
                            const steps = generatedText.split('\n').filter(line => line.trim().length > 0);
                            setSuggestions(steps);
                        }
                    } catch (error) {
                        console.error("Error generating suggestions:", error);
                        setSuggestions(["An error occurred. Please try again."]);
                    } finally {
                        setIsSuggestionsLoading(false);
                    }
                };

                const generateTaskSteps = async (taskText) => {
                    setAiLoading(true);
                    setShowAIModal(true);
                    setAiSteps([]);
                    const apiKey = "AIzaSyDZQ_6Gll1-fDTtBOPDg-Jg4oswPu-KR_E";
				    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    
                    const systemPrompt = "You are a productivity expert. Your goal is to break down large, daunting tasks into small, manageable, and actionable steps. Provide a clear, numbered list of steps. Do not include a conversational intro. Only return the list.";
                    const userQuery = `Break down the following task into a numbered list of actionable, sequential steps: ${taskText}`;
                    
                    const payload = { contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }]} };

                    try {
                        let response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                        if (!response.ok) throw new Error(`API call failed: ${response.statusText}`);
                        const result = await response.json();
                        const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (generatedText) {
                            const steps = generatedText.split('\n').filter(line => line.trim().length > 0);
                            setAiSteps(steps);
                        } else {
                            setAiSteps(["Sorry, I couldn't generate steps for that task. Please try a different one."]);
                        }
                    } catch (error) {
                        console.error("Error calling Gemini API:", error);
                        setAiSteps(["An error occurred. Please check your network connection and try again."]);
                    } finally {
                        setAiLoading(false);
                    }
                };
                
                const addAllStepsAsTasks = () => {
                    const newTasks = aiSteps.map(step => ({ id: Date.now() + Math.random(), text: step.replace(/^\d+\.\s*/, ''), completed: false }));
                    setTasks([...tasks, ...newTasks]);
                    setTasksAssigned(prev => prev + newTasks.length); // Increment tasks assigned for each new task
                    setShowAIModal(false);
                };

                // Function to handle sending a chat message
                const sendChatMessage = async (e) => {
                    e.preventDefault();
                    if (!chatInput.trim()) return;

                    const userMessage = { role: 'user', content: chatInput };
                    const updatedChatHistory = [...chatHistory, userMessage];
                    setChatHistory(updatedChatHistory);
                    setChatInput('');
                    setIsChatLoading(true);

                    const apiKey = "AIzaSyDZQ_6Gll1-fDTtBOPDg-Jg4oswPu-KR_E";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                    const systemPrompt = "You are a friendly and encouraging wellness and productivity coach. Keep your responses concise and positive. Ask questions to keep the conversation going.";

                    const payload = {
                        contents: [
                            ...updatedChatHistory.map(msg => ({ role: msg.role === 'user' ? 'user' : 'model', parts: [{ text: msg.content }] })),
                            // Add a separator or a final instruction to guide the model
                            { role: 'user', parts: [{ text: 'Please respond now.' }] }
                        ],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                    };

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload),
                        });
                        const result = await response.json();
                        const aiMessage = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (aiMessage) {
                            setChatHistory(prev => [...prev, { role: 'model', content: aiMessage }]);
                        } else {
                            setChatHistory(prev => [...prev, { role: 'model', content: "Sorry, I couldn't process that. Could you try again?" }]);
                        }
                    } catch (error) {
                        console.error("Error sending chat message:", error);
                        setChatHistory(prev => [...prev, { role: 'model', content: "An error occurred. Please check your network connection and try again." }]);
                    } finally {
                        setIsChatLoading(false);
                    }
                };

                // Main UI structure
                return (
                    <div className="bg-white rounded-[2rem] shadow-2xl max-w-6xl w-full p-8 md:p-12 transition-all duration-300">
                        {/* Header Section */}
                        <header className="text-center mb-10">
                            <h1 className="text-5xl md:text-6xl font-extrabold text-blue-600 mb-2 tracking-tighter">Flow</h1>
                            <p className="text-gray-500 font-medium text-lg">Your work, your well-being, in sync.</p>
                            <p className="text-sm text-gray-400 mt-4 font-light">{formatDateTime(currentDateTime)}</p>
                            <div className="flex justify-center mt-4 space-x-4">
                                <button onClick={openMetrics} className="py-2 px-6 rounded-full text-blue-600 border border-blue-600 font-bold hover:bg-blue-50 transition-colors">
                                    Metrics Dashboard
                                </button>
                            </div>
                        </header>

                        {/* Today's Focus Summary */}
                        <section className="mb-10 p-6 md:p-8 bg-indigo-50 rounded-[2rem] border-2 border-indigo-200 shadow-md">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-2xl font-bold text-indigo-700">Today's Focus Summary</h2>
                                {initiatedSessions > 0 && (
                                    <button onClick={clearHistory} className="text-sm text-indigo-500 hover:text-indigo-700 font-medium transition-colors">
                                        Clear History
                                    </button>
                                )}
                            </div>
                            <div className="flex flex-col md:flex-row items-center gap-4 md:gap-8 mb-4">
                                <span className="text-5xl md:text-6xl font-bold text-indigo-800 tracking-tight">{utilizedFocusTime}</span>
                                <div className="text-center md:text-left">
                                    <span className="text-xl text-indigo-600">minutes focused across</span>
                                    <span className="text-3xl font-bold text-indigo-800 ml-2">{sessionHistory.length}</span>
                                    <span className="text-xl text-indigo-600 ml-1">session{sessionHistory.length !== 1 ? 's' : ''} started.</span>
                                </div>
                            </div>
                            <ul className="space-y-2 text-sm text-gray-600">
                                {sessionHistory.length > 0 ? (
                                    sessionHistory.map((session, index) => (
                                        <li key={session.id} className="flex justify-between items-center p-3 bg-indigo-100 rounded-xl">
                                            <span>Session {index + 1}: {session.duration} minutes</span>
                                            <span className="text-xs text-gray-500">{session.date.toLocaleTimeString()}</span>
                                        </li>
                                    ))
                                ) : (
                                    <li className="text-center italic text-gray-500 py-4">No sessions completed yet. Start your first one!</li>
                                )}
                            </ul>
                        </section>

                        {/* Main Grid: Focus Timer and AI Wellness */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                            {/* Focus Session Panel */}
                            <div className="bg-white p-6 rounded-[2rem] shadow-lg border-2 border-blue-200 flex flex-col items-center justify-center">
                                <h2 className="text-2xl font-bold text-blue-700 mb-4">Focus Session</h2>
                                <div className="text-7xl font-mono font-light text-blue-800 mb-4 tracking-tighter">
                                    {formatTime(timer)}
                                </div>
                                <div className="flex flex-col md:flex-row gap-4 w-full justify-center items-center">
                                    {!isFocused && (
                                        <div className="flex items-center gap-2">
                                            <input
                                                type="number"
                                                value={sessionDurationMinutes}
                                                onChange={(e) => setSessionDurationMinutes(parseInt(e.target.value) || 0)}
                                                className="w-20 text-center text-xl p-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                min="1" max="120" aria-label="Set session duration in minutes"
                                            />
                                            <span className="text-gray-500 text-sm">minutes</span>
                                        </div>
                                    )}
                                    {!isFocused ? (
                                        <button
                                            onClick={startFocusTimer}
                                            className="w-full py-3 px-6 rounded-full font-bold text-white transition-colors duration-300 transform bg-blue-600 hover:bg-blue-700 shadow-md hover:shadow-lg"
                                        >
                                            Start Session
                                        </button>
                                    ) : (
                                        <button
                                            onClick={handleEndSessionWarning}
                                            className="w-full py-3 px-6 rounded-full font-bold text-white transition-colors duration-300 transform bg-red-600 hover:bg-red-700 shadow-md hover:shadow-lg"
                                        >
                                            End Session
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* AI Wellness Coach Panel */}
                            <div className="bg-white p-6 rounded-[2rem] shadow-lg border-2 border-pink-200 flex flex-col justify-between items-center text-center">
                                <h2 className="text-2xl font-bold text-pink-700 mb-4">AI Wellness Coach</h2>
                                <p className="text-lg font-medium text-gray-600 italic mb-6">
                                    {nudge || "Get started with your tasks to see your first nudge."}
                                </p>
                                <button
                                    onClick={getAISuggestions}
                                    className="w-full py-3 px-6 rounded-full font-bold text-white transition-colors duration-300 transform bg-pink-600 hover:bg-pink-700 shadow-md hover:shadow-lg"
                                >
                                    Get Suggestions
                                </button>
                            </div>
                        </div>

                        {/* Tasks and Habits Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                            {/* Tasks Panel */}
                            <div className="bg-white p-6 rounded-[2rem] shadow-lg border-2 border-gray-200">
                                <h2 className="text-2xl font-bold text-green-700 mb-4">Today's Tasks</h2>
                                <form onSubmit={addTask} className="flex gap-2 mb-6">
                                    <input
                                        type="text"
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        placeholder="Add a new task..."
                                        className="flex-grow p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    />
                                    <button
                                        type="submit"
                                        className="p-3 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-700 transition-colors transform hover:scale-110"
                                        aria-label="Add a new task"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                        </svg>
                                    </button>
                                </form>
                                <ul className="space-y-3">
                                    {tasks.map((task) => (
                                        <li
                                            key={task.id}
                                            className={`flex items-center justify-between p-4 rounded-xl shadow-sm transition-all duration-300 ${
                                                task.completed ? 'bg-gray-200 line-through text-gray-500' : 'bg-white border border-gray-200'
                                            }`}
                                        >
                                            <div className="flex-grow flex items-center gap-4">
                                                <input
                                                    type="checkbox"
                                                    checked={task.completed}
                                                    onChange={() => toggleTask(task.id)}
                                                    className="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 cursor-pointer"
                                                />
                                                <span className="font-medium text-base">{task.text}</span>
                                            </div>
                                            <div className="flex items-center space-x-2">
                                                <button
                                                    onClick={() => generateTaskSteps(task.text)}
                                                    className="p-2 rounded-full bg-yellow-400 text-white text-xs font-bold hover:bg-yellow-500 transition-colors transform hover:scale-110"
                                                    aria-label="Generate AI steps"
                                                >
                                                    âœ¨
                                                </button>
                                                <button
                                                    onClick={() => deleteTask(task.id)}
                                                    className="p-2 rounded-full text-white bg-red-500 hover:bg-red-600 transition-colors transform hover:scale-110"
                                                    aria-label="Delete task"
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                                        <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            </div>

                            {/* Habits Panel */}
                            <div className="bg-white p-6 rounded-[2rem] shadow-lg border-2 border-purple-200">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-bold text-purple-700">Daily Habits</h2>
                                    <button
                                        onClick={openHabitModal}
                                        className="py-2 px-4 bg-purple-600 text-white rounded-full font-bold text-sm hover:bg-purple-700 transition-colors"
                                    >
                                        + Add New Habit
                                    </button>
                                </div>
                                <ul className="space-y-3">
                                    {habits.map((habit) => {
                                        const timeElapsed = Math.floor((Date.now() - (habit.lastNotified || Date.now())) / 1000);
                                        const timeRemaining = (habit.recurringInterval * 60) - timeElapsed;
                                        const timeDisplay = timeRemaining > 0 ? `Next in: ${formatTime(timeRemaining)}` : 'Time to do it!';
                                        return (
                                            <li
                                                key={habit.id}
                                                className={`flex items-center justify-between p-4 rounded-xl shadow-sm transition-all duration-300 ${
                                                    habit.completed ? 'bg-purple-200 line-through text-purple-800' : 'bg-white border border-gray-200'
                                                }`}
                                            >
                                                <div className="flex-grow flex flex-col">
                                                    <span className="font-medium text-base">{habit.name}</span>
                                                    <span className="text-sm text-gray-500">{timeDisplay}</span>
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <button
                                                        onClick={() => deleteHabit(habit.id)}
                                                        className="p-2 rounded-full text-white bg-red-500 hover:bg-red-600 transition-colors transform hover:scale-110"
                                                        aria-label="Delete habit"
                                                    >
                                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                                            <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                                                    </svg>
                                                    </button>
                                                    <input
                                                        type="checkbox"
                                                        checked={habit.completed}
                                                        onChange={() => toggleHabit(habit.id)}
                                                        className="w-5 h-5 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 cursor-pointer"
                                                    />
                                                </div>
                                            </li>
                                        );
                                    })}
                                </ul>
                            </div>
                        </div>
                        
                        {/* Chatbot Section */}
                        <section class="p-6 md:p-8 bg-white rounded-[2rem] border-2 border-orange-200 shadow-lg flex flex-col h-[400px] mb-10">
                            <h2 class="text-3xl font-bold text-orange-700 mb-4">Ask Gemini</h2>
                            <form onSubmit={sendChatMessage} class="flex items-center space-x-2 md:space-x-4 mb-4">
                                <input
                                    id="queryInput"
                                    type="text"
                                    value={chatInput}
                                    onChange={(e) => setChatInput(e.target.value)}
                                    placeholder="e.g., Explain the Pomodoro Technique"
                                    class="flex-grow p-4 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 transition-shadow"
                                    disabled={isChatLoading}
                                />
                                <button
                                    id="askButton"
                                    type="submit"
                                    class="p-3 bg-orange-600 text-white rounded-full font-bold hover:bg-orange-700 transition-colors shadow-md disabled:bg-gray-400"
                                    disabled={isChatLoading}
                                    aria-label="Send message"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                    </svg>
                                </button>
                            </form>
                            <div class="h-[250px] overflow-y-auto space-y-4 p-2 rounded-2xl bg-gray-50 border border-gray-200">
                                {chatHistory.length === 0 && !isChatLoading && (
                                    <p class="text-center text-gray-400 italic mt-8">
                                        Your response will appear here.
                                    </p>
                                )}
                                {chatHistory.map((message, index) => (
                                    <div 
                                        key={index}
                                        class={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
                                    >
                                        <div class={`p-3 rounded-2xl max-w-[70%] text-sm shadow-sm ${
                                            message.role === 'user' 
                                                ? 'bg-orange-600 text-white rounded-br-none' 
                                                : 'bg-orange-100 text-orange-800 rounded-bl-none'
                                        }`}>
                                            {message.content}
                                        </div>
                                    </div>
                                ))}
                                {isChatLoading && (
                                    <div class="flex justify-start">
                                        <div class="p-3 bg-gray-200 rounded-2xl rounded-bl-none">
                                            <div class="w-6 h-6 border-2 border-orange-500 border-dashed rounded-full animate-spin"></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </section>

                        {/* Motivational Quote Section */}
                        <section className="p-6 md:p-8 bg-white rounded-[2rem] border-2 border-teal-200 shadow-md text-center">
                            <p className="text-2xl md:text-3xl font-light italic text-gray-600 mb-2">"{dailyQuote.split('-')[0].trim()}"</p>
                            <p className="text-lg font-medium text-gray-500">- {dailyQuote.split('-')[1].trim()}</p>
                        </section>

                        {/* Modals Section */}
                        {/* Warning Modal */}
                        {showWarning && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-sm w-full">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4">End Session?</h3>
                                    <p className="text-gray-600 mb-6">Are you sure you want to end your focus session?</p>
                                    <div className="flex justify-center gap-4">
                                        <button onClick={() => setShowWarning(false)} className="py-2 px-6 bg-gray-300 text-gray-800 rounded-full font-bold hover:bg-gray-400 transition-colors">Cancel</button>
                                        <button onClick={() => stopSession(false)} className="py-2 px-6 bg-red-600 text-white rounded-full font-bold hover:bg-red-700 transition-colors">End Session</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* AI Suggestions Modal */}
                        {showSuggestionsModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center">{suggestionsTitle}</h3>
                                    {isSuggestionsLoading ? (
                                        <div className="flex justify-center items-center h-24"><div className="w-8 h-8 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div></div>
                                    ) : (
                                        <>
                                            <ul className="list-disc list-inside space-y-2 text-gray-700 mb-6">
                                                {suggestions.length > 0 ? suggestions.map((step, index) => (<li key={index}>{step}</li>)) : (<li>No suggestions generated. Please try again.</li>)}
                                            </ul>
                                            <div className="flex justify-center mt-4">
                                                <button onClick={() => setShowSuggestionsModal(false)} className="py-3 px-8 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-700 transition-colors">Close</button>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* AI Steps Modal */}
                        {showAIModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full relative">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4 text-center">AI Task Breakdown</h3>
                                    {aiLoading ? (
                                        <div className="flex justify-center items-center min-h-[100px]"><div className="w-8 h-8 border-4 border-blue-500 border-dashed rounded-full animate-spin"></div></div>
                                    ) : (
                                        aiSteps.length > 0 ? (
                                            <div className="max-h-[70vh] overflow-y-auto pr-2">
                                                <ul className="list-disc list-inside space-y-2 text-gray-700 mb-6">
                                                    {aiSteps.map((step, index) => (<li key={index}>{step}</li>))}
                                                </ul>
                                            </div>
                                        ) : (<p className="text-center text-gray-600">No steps were generated. Try again.</p>)
                                    )}
                                    <div className="flex justify-center gap-4 mt-4">
                                        <button onClick={addAllStepsAsTasks} className="py-2 px-6 bg-green-600 text-white rounded-full font-bold hover:bg-green-700 transition-colors">Add All to Tasks</button>
                                        <button onClick={() => setShowAIModal(false)} className="py-2 px-6 bg-gray-300 text-gray-800 rounded-full font-bold hover:bg-gray-400 transition-colors">Close</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Add Habit Modal */}
                        {showHabitModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-sm w-full">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4">Add New Habit</h3>
                                    <form onSubmit={addHabit}>
                                        <input 
                                            type="text" 
                                            value={newHabitName} 
                                            onChange={(e) => setNewHabitName(e.target.value)} 
                                            placeholder="e.g., Take a 10-minute walk" 
                                            className="w-full p-3 mb-4 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow" 
                                            required
                                        />
                                        <div className="flex items-center gap-2 mb-4">
                                            <span className="text-gray-700">Remind me every</span>
                                            <input type="number" value={recurringInterval} onChange={(e) => setRecurringInterval(e.target.value)} min="1" className="w-20 text-center p-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
                                            <span className="text-gray-700">minutes</span>
                                        </div>
                                        <div className="flex justify-center gap-4 mt-4">
                                            <button type="button" onClick={closeHabitModal} className="py-2 px-6 bg-gray-300 text-gray-800 rounded-full font-bold hover:bg-gray-400 transition-colors">Cancel</button>
                                            <button type="submit" className="py-2 px-6 bg-blue-600 text-white rounded-full font-bold hover:bg-blue-700 transition-colors">Save</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* Recurring Habit Nudge Modal */}
                        {activeHabitNudge && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl shadow-2xl p-8 text-center max-w-sm w-full">
                                    <h3 className="text-2xl font-bold text-gray-800 mb-4">Time to {activeHabitNudge.name}!</h3>
                                    <p className="text-gray-600 mb-6">Your reminder is here. Let's stay on track with our habits.</p>
                                    <div className="flex justify-center gap-4">
                                        <button onClick={() => markHabitAsDone(activeHabitNudge.id)} className="py-2 px-6 bg-green-600 text-white rounded-full font-bold hover:bg-green-700 transition-colors">Mark as Done</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {showBreakActivityModal && (
                            <MindfulBreakModal 
                                onEndBreak={endBreak}
                                currentBreakActivity={currentBreakActivity}
                                breakTimer={breakTimer}
                                setBreakTimer={setBreakTimer}
                            />
                        )}
                        {showMetricsModal && (
                            <MetricsDashboardModal
                                onClose={closeMetrics}
                                selectedTime={selectedFocusTime}
                                utilizedTime={utilizedFocusTime}
                                dailyHabitsCount={dailyHabitsCount}
                                habitsCompleted={habitsCompleted}
                                tasksCompleted={tasksCompleted}
                                tasksAssigned={tasksAssigned}
                                productivityScore={productivityScore}
                            />
                        )}
                        {showSuccessModal && <SuccessModal onClose={() => setShowSuccessModal(false)} />}
                    </div>
                );
            };
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        };
    </script>
</body>
<footer class="w-full text-center mt-8 py-4 bg-gray-100 text-gray-600 text-sm rounded-t-2xl border-t border-gray-200">
    <div class="container mx-auto px-4">
        <p class="text-xs sm:text-sm">
            &copy; 2025 Arman Mahmud | 
            <a href="mailto:armanmahmud.du18@gmail.com" class="hover:text-gray-800 transition duration-300">armanmahmud.du18@gmail.com</a>
        </p>
    </div>
</footer>
</html>




